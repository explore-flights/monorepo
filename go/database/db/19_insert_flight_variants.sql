-- insert new variants
INSERT INTO flight_variants (
  id,
  operating_airline_id,
  operating_number,
  operating_suffix,
  departure_airport_id,
  departure_time_local,
  departure_utc_offset_seconds,
  duration_seconds,
  arrival_airport_id,
  arrival_utc_offset_seconds,
  service_type,
  aircraft_owner,
  aircraft_id,
  aircraft_configuration_version,
  aircraft_registration,
  code_shares_hash,
  code_shares
)
SELECT
  UUID(),
  airlineId,
  flightNumber,
  suffix,
  departureAirportId,
  departureTimeLocal,
  departureUTCOffsetSeconds,
  durationSeconds,
  arrivalAirportId,
  arrivalUTCOffsetSeconds,
  serviceType,
  aircraftOwner,
  aircraftId,
  aircraftConfigurationVersion,
  registration,
  HASH(codeShares),
  codeShares
FROM lh_flight_schedules_operating_with_cs
GROUP BY
    airlineId,
    flightNumber,
    suffix,
    departureAirportId,
    departureTimeLocal,
    departureUTCOffsetSeconds,
    durationSeconds,
    arrivalAirportId,
    arrivalUTCOffsetSeconds,
    serviceType,
    aircraftOwner,
    aircraftId,
    aircraftConfigurationVersion,
    registration,
    codeShares
ON CONFLICT (
  operating_airline_id,
  operating_number,
  operating_suffix,
  departure_airport_id,
  departure_time_local,
  departure_utc_offset_seconds,
  duration_seconds,
  arrival_airport_id,
  arrival_utc_offset_seconds,
  service_type,
  aircraft_owner,
  aircraft_id,
  aircraft_configuration_version,
  aircraft_registration,
  code_shares_hash
) DO NOTHING ;